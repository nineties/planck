==================
Object File Format
==================

**The byte-order is always little endian.**

Encoding of Types
==================

+----------+------------------+------------------------------------------------+
| 1st byte | following bytes  | type constructor                               |
+==========+==================+================================================+
| 0xxxxxxx | args             | User defined type whose index is upto 127      |
+----------+------------------+------------------------------------------------+
| 1000xxxx | xxx args         | Tuple type whose length is upto 15             |
+----------+------------------+------------------------------------------------+
| 1001xxxx | 1 arg            | Array type whose length is upto 15             |
+----------+------------------+------------------------------------------------+
| 101xxxxx | ret + args       | Function type whose number of arguments is     |
|          |                  | upto 15                                        |
+----------+------------------+------------------------------------------------+
| 11000000 |                  | never, bool, char, u8, i8, u16, i16, u32, i32, |
| -        |                  | u64, i64, f32, f64, str                        |
| 11001101 |                  |                                                |
+----------+------------------+------------------------------------------------+
| 11001110 | 1 byte + args    | Tuple type whose length is upto 255            |
+----------+------------------+------------------------------------------------+
| 11001111 | 1 byte + 1 arg   | Array type whose length is upto 255            |
+----------+------------------+------------------------------------------------+
| 11010000 | 2 byte + 1 arg   | Array type whose length is upto 2^16-1         |
+----------+------------------+------------------------------------------------+
| 11010001 | 4 byte + 1 arg   | Array type whose length is upto 2^32-1         |
+----------+------------------+------------------------------------------------+
| 11010010 | 1 byte + args    | User defined type whose index is upto 255      |
+----------+------------------+------------------------------------------------+
| 11010011 | 2 byte + args    | User defined type whose index is upto 2^16-1   |
+----------+------------------+------------------------------------------------+
| 11010100 | 4 byte + args    | User defined type whose index is upto 2^32-1   |
+----------+------------------+------------------------------------------------+
| 11010101 | arg              | Slice type                                     |
+----------+------------------+------------------------------------------------+
| 11010110 | arg              | Reference type                                 |
+----------+------------------+------------------------------------------------+
| 11010111 | arg              | Mutable reference type                         |
+----------+------------------+------------------------------------------------+
| 11011000 | arg              | Raw pointer type                               |
+----------+------------------+------------------------------------------------+
| 11011001 | arg              | Mutable raw pointer type                       |
+----------+------------------+------------------------------------------------+
| 11011010 | 1 byte +         | Function type whose number of arguments is     |
|          | ret + args       | upto 255                                       |
+----------+------------------+------------------------------------------------+


Encoding of Values
==================

+----------+----------+------------------+-------------------------------------+
| type     | 1st byte | following bytes  |                                     |
+==========+==========+==================+=====================================+
| u8       | 0xxxxxxx |                  | 7-bit unsigned int                  |
+----------+----------+------------------+-------------------------------------+
| register | 1000xxxx |                  | Register whose index is upto 15     |
+----------+----------+------------------+-------------------------------------+
| tuple    | 1001xxxx | xxx objects      | Tuple whose length is upto 15       |
+----------+----------+------------------+-------------------------------------+
| str      | 101xxxxx | xxxxx bytes      | UTF-8 string upto 31 bytes          |
+----------+----------+------------------+-------------------------------------+
| true     | 11000000 |                  |                                     |
+----------+----------+------------------+-------------------------------------+
| false    | 11000001 |                  |                                     |
+----------+----------+------------------+-------------------------------------+
| u8       | 11000010 | 1 byte           | 8-bit unsigned int                  |
+----------+----------+------------------+-------------------------------------+
| i8       | 11000011 | 1 byte           | 8-bit signed int                    |
+----------+----------+------------------+-------------------------------------+
| u16      | 11000100 | 2 byte           | 16-bit unsigned int                 |
+----------+----------+------------------+-------------------------------------+
| i16      | 11000101 | 2 byte           | 16-bit signed int                   |
+----------+----------+------------------+-------------------------------------+
| u32      | 11000110 | 4 byte           | 32-bit unsigned int                 |
+----------+----------+------------------+-------------------------------------+
| i32      | 11000111 | 4 byte           | 32-bit signed int                   |
+----------+----------+------------------+-------------------------------------+
| u64      | 11001000 | 8 byte           | 64-bit unsigned int                 |
+----------+----------+------------------+-------------------------------------+
| i64      | 11001001 | 8 byte           | 64-bit signed int                   |
+----------+----------+------------------+-------------------------------------+
| f32      | 11001010 | 4 byte           | IEEE754 single-precision float      |
+----------+----------+------------------+-------------------------------------+
| f64      | 11001011 | 8 byte           | IEEE754 double-precision float      |
+----------+----------+------------------+-------------------------------------+
| char     | 11001100 | uint object      | UTF-8 character                     |
+----------+----------+------------------+-------------------------------------+
| str      | 11001101 | 1 byte + data    | UTF-8 string whose length is        |
|          |          |                  | upto 2^8-1 bytes                    |
+----------+----------+------------------+-------------------------------------+
| str      | 11001110 | 2 byte + data    | UTF-8 string whose length is        |
|          |          |                  | upto 2^16-1 bytes                   |
+----------+----------+------------------+-------------------------------------+
| str      | 11001111 | 4 byte + data    | UTF-8 string whose length is        |
|          |          |                  | upto 2^32-1 bytes                   |
+----------+----------+------------------+-------------------------------------+
| tuple    | 11010000 | 1 byte + objects | Tuple whose length is upto 255      |
+----------+----------+------------------+-------------------------------------+
| array    | 11010001 | 1 byte + objects | Array whose length is upto 255      |
+----------+----------+------------------+-------------------------------------+
| array    | 11010010 | 2 byte + objects | Array whose length is upto 2^16-1   |
+----------+----------+------------------+-------------------------------------+
| array    | 11010011 | 4 byte + objects | Array whose length is upto 2^32-1   |
+----------+----------+------------------+-------------------------------------+
| register | 11010100 | 1 byte           | Register whose index is upto 255    |
+----------+----------+------------------+-------------------------------------+
| register | 11010101 | 2 byte           | Register whose index is upto 2^16-1 |
+----------+----------+------------------+-------------------------------------+
| i8       | 111xxxxx |                  | 5-bit signed int                    |
+----------+----------+------------------+-------------------------------------+


File Format
===========

+--------------+----------------------------------+
| field length | content                          |
+==============+==================================+
| 4 bytes      | File magic "PLNK"                |
+--------------+----------------------------------+
| u32          | Data size (N)                    |
+--------------+----------------------------------+
| N bytes      | Sections                         |
+--------------+----------------------------------+

Section Format
==============

+--------------+----------------------------------+
| field length | content                          |
+==============+==================================+
| 4 bytes      | Section type                     |
|              |                                  |
|              | 4 ascii characters like "Code"   |
+--------------+----------------------------------+
| u32          | Section size (N)                 |
+--------------+----------------------------------+
| N bytes      | Section dependent data           |
+--------------+----------------------------------+
| (N - 3)/4*4  | Padding to fit 4-byte boundary   |
| bytes        |                                  |
+--------------+----------------------------------+

"Name" - Name Table
-------------------

Identifiers used for variables, constants, functions, types, etc.

+--------------+----------------------------------+
| field length | content                          |
+==============+==================================+
| u32          | Name count (N)                   |
+--------------+----------------------------------+
| ...          | Name 0 (null-terminated string)  |
+--------------+----------------------------------+
| ...          | ...                              |
+--------------+----------------------------------+
| ...          | Name N-1                         |
+--------------+----------------------------------+

"ExpT" - Export Table
---------------------

Table of variables, constants, functions, types, etc. which are exported.

+--------------+----------------------------------+
| field length | content                          |
+==============+==================================+
| u32          | Entry count (N)                  |
+--------------+----------------------------------+
| ...          | N entries                        |
+--------------+----------------------------------+

Each entry has following format.

+--------------+----------------------------------+
| field length | content                          |
+==============+==================================+
| u24          | Index of Name                    |
+--------------+----------------------------------+
| u8           | Entry type                       |
|              |                                  |
|              | * 'V': variable                  |
|              | * 'C': constant                  |
|              | * 'F': function                  |
|              | * 'G': generic function          |
|              | * 'T': type                      |
+--------------+----------------------------------+
| u32          | Index of definition              |
+--------------+----------------------------------+

"Func" - Function Table
-----------------------

+--------------+----------------------------------+
| field length | content                          |
+==============+==================================+
| u32          | Function count (N)               |
+--------------+----------------------------------+
| ...          | N entries                        |
+--------------+----------------------------------+

Each entry has following format.

+--------------+----------------------------------+
| field length | content                          |
+==============+==================================+
| u32          | Function count (N)               |
+--------------+----------------------------------+
| ...          | Byte-encoding of function type   |
+--------------+----------------------------------+
| ...          | Byte-encoding of basic block 0   |
+--------------+----------------------------------+
| ...          |                                  |
+--------------+----------------------------------+
| ...          | Byte-encoding of basic block N-1 |
+--------------+----------------------------------+

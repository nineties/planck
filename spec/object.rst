==================
Object File Format
==================

Encoding of Builtin Data
========================

The byte-order is always little endian.

Integers::

   **u8**: unsigned 7-bit integer
   +-----------+
   | 0xxxxxxxx |
   +-----------+

   **i8**: signed 7-bit integer
   +-----------+
   | 111xxxxxx |
   +-----------+

   **u8**: unsigned 8-bit integer
   +------+------+
   | 0x80 | 0xXX |
   +------+------+

   **i8**: signed 8-bit integer
   +------+------+
   | 0x81 | 0xXX |
   +------+------+

   **u16**: unsigned 16-bit integer
   +------+------+------+
   | 0x82 | 0xXX | 0xXX |
   +------+------+------+

   **i16**: signed 16-bit integer
   +------+------+------+
   | 0x83 | 0xXX | 0xXX |
   +------+------+------+

   **u32**: unsigned 32-bit integer
   +------+------+------+------+------+
   | 0x84 | 0xXX | 0xXX | 0xXX | 0xXX |
   +------+------+------+------+------+

   **i32**: signed 32-bit integer
   +------+------+------+------+------+
   | 0x85 | 0xXX | 0xXX | 0xXX | 0xXX |
   +------+------+------+------+------+

   **u64**: unsigned 64-bit integer
   +------+------+------+------+------+------+------+------+------+
   | 0x86 | 0xXX | 0xXX | 0xXX | 0xXX | 0xXX | 0xXX | 0xXX | 0xXX |
   +------+------+------+------+------+------+------+------+------+

   **i64**: signed 64-bit integer
   +------+------+------+------+------+------+------+------+------+
   | 0x87 | 0xXX | 0xXX | 0xXX | 0xXX | 0xXX | 0xXX | 0xXX | 0xXX |
   +------+------+------+------+------+------+------+------+------+

Floating Poit Numbers::

   **f32** IEEE 754 single-precision floating point number
   +------+------+------+------+------+
   | 0x8A | 0xXX | 0xXX | 0xXX | 0xXX |
   +------+------+------+------+------+

   **f64** IEEE 754 double-precision floating point number
   +------+------+------+------+------+------+------+------+------+
   | 0x8B | 0xXX | 0xXX | 0xXX | 0xXX | 0xXX | 0xXX | 0xXX | 0xXX |
   +------+------+------+------+------+------+------+------+------+

Booleans::

   **bool**: true
   +------+
   | 0x90 |
   +------+

   **bool**: false
   +------+
   | 0x91 |
   +------+

Character::

   **char*:: UTF-8 character
   +------+~~~~~~~~~~~~~~~~~~+
   | 0x92 | u8 or u16 or u32 |
   +------+~~~~~~~~~~~~~~~~~~+


File Format
===========

+--------------+----------------------------------+
| field length | content                          |
+==============+==================================+
| 4 bytes      | File magic "PLNK"                |
+--------------+----------------------------------+
| u32          | Data size (N)                    |
+--------------+----------------------------------+
| N bytes      | Sections                         |
+--------------+----------------------------------+

Section Format
==============

+--------------+----------------------------------+
| field length | content                          |
+==============+==================================+
| 4 bytes      | Section type                     |
|              |                                  |
|              | 4 ascii characters like "Code"   |
+--------------+----------------------------------+
| u32          | Section size (N)                 |
+--------------+----------------------------------+
| N bytes      | Section dependent data           |
+--------------+----------------------------------+
| (N - 3)/4*4  | Padding to fit 4-byte boundary   |
| bytes        |                                  |
+--------------+----------------------------------+

"Name" - Name Table
-------------------

Identifiers used for variables, constants, functions, types, etc.

+--------------+----------------------------------+
| field length | content                          |
+==============+==================================+
| u32          | Name count (N)                   |
+--------------+----------------------------------+
| ...          | Name 0 (null-terminated string)  |
+--------------+----------------------------------+
| ...          | ...                              |
+--------------+----------------------------------+
| ...          | Name N-1                         |
+--------------+----------------------------------+

"ExpT" - Export Table
---------------------

Table of variables, constants, functions, types, etc. which are exported.

+--------------+----------------------------------+
| field length | content                          |
+==============+==================================+
| u32          | Entry count (N)                  |
+--------------+----------------------------------+
| ...          | N entries                        |
+--------------+----------------------------------+

Each entry has following format.

+--------------+----------------------------------+
| field length | content                          |
+==============+==================================+
| u24          | Index of Name                    |
+--------------+----------------------------------+
| u8           | Entry type                       |
|              |                                  |
|              | * 'V': variable                  |
|              | * 'C': constant                  |
|              | * 'F': function                  |
|              | * 'G': generic function          |
|              | * 'T': type                      |
+--------------+----------------------------------+
| u32          | Index of definition              |
+--------------+----------------------------------+

"Func" - Function Table
-----------------------

+--------------+----------------------------------+
| field length | content                          |
+==============+==================================+
| u32          | Function count (N)               |
+--------------+----------------------------------+
| ...          | N entries                        |
+--------------+----------------------------------+

Each entry has following format.

+--------------+----------------------------------+
| field length | content                          |
+==============+==================================+
| u32          | Function count (N)               |
+--------------+----------------------------------+
| ...          | Byte-encoding of function type   |
+--------------+----------------------------------+
| ...          | Byte-encoding of basic block 0   |
+--------------+----------------------------------+
| ...          |                                  |
+--------------+----------------------------------+
| ...          | Byte-encoding of basic block N-1 |
+--------------+----------------------------------+
